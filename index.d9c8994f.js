let frame=0,resolution=2,flag=!0;var globalCanvasAllImgMsg=[],globalChooseImgMark=null,moveStartPosition={x:0,y:0};const canvasdom=document.getElementById("main"),cvs=canvasdom.getContext("2d");let canvasWidth=canvasdom.width,canvasHeight=canvasdom.height;canvasdom.style.width=canvasWidth/resolution+"px",canvasdom.style.height=canvasHeight/resolution+"px";let clickStartLocationX=0,clickOriginalSize={width:0,height:0};function throttle(l,a){let t;return function(){let e=this,o=arguments;t||(t=setTimeout((()=>{t=null,l.apply(e,o)}),a))}}async function getTheImage(l){let a,t=l.clipboardData.items,e=[];if(t&&1==t.length)a=t[0].getAsFile();else for(let l=0;l<t.length;l++){const a=t[l];e.push(a.getAsFile())}const o=new FileReader;if(0==e.length)a&&o.readAsDataURL(a),o.onload=l=>{drawImage(l.target.result)};else{let l=[];e.reverse();for(let a=0;a<e.length;a++){const t=e[a];await new Promise((a=>{o.readAsDataURL(t),o.onload=t=>{l.push(t.target.result),a()}}))}drawAnima(l)}}function drawImage(l){const a=new Image;a.src=l,a.complete?(cvs.drawImage(a,0,0),globalCanvasAllImgMsg.push({url:l,left:0,top:0,width:a.width,height:a.height,mark:globalCanvasAllImgMsg.length,width2:a.width,height2:a.height})):a.onload=()=>{cvs.drawImage(a,0,0),globalCanvasAllImgMsg.push({url:l,left:0,top:0,width:a.width,height:a.height,mark:globalCanvasAllImgMsg.length,width2:a.width,height2:a.height})}}function drawAnima(l){const a=new Image;a.src=l[frame],a.complete?(cvs.drawImage(a,0,0),globalCanvasAllImgMsg.push({urlList:l,type:"anima",left:0,top:0,width:a.width,height:a.height,mark:globalCanvasAllImgMsg.length,width2:a.width,height2:a.height})):a.onload=()=>{cvs.drawImage(a,0,0),globalCanvasAllImgMsg.push({urlList:l,type:"anima",left:0,top:0,width:a.width,height:a.height,mark:globalCanvasAllImgMsg.length,width2:a.width,height2:a.height})}}function rndCol(){return"rgb("+Math.floor(180*Math.random())+","+Math.floor(60*Math.random())+","+Math.floor(100*Math.random())+")"}function redraw(l,a=0){cvs.clearRect(0,0,2*canvasWidth,2*canvasHeight);for(let t=0;t<l.length;t++){let e=l[t];if(e.luminous?(cvs.shadowBlur=Math.min(e.width2||e.width,e.height2||e.height)/3,cvs.shadowColor=rndCol()):cvs.shadowBlur=0,e.type){const l=new Image;l.src=e.urlList[frame%e.urlList.length],l.complete?(a&&(cvs.translate(e.left,e.top),cvs.rotate(a),cvs.translate(-e.left,-e.top)),cvs.drawImage(l,0,0,e.width,e.height,e.left,e.top,e.width2||e.width,e.height2||e.height),cvs.translate(e.left,e.top),cvs.rotate(-a),cvs.translate(-e.left,-e.top),e.luminous?(console.log("发光"),cvs.shadowBlur=80,cvs.shadowOffsetX=2,cvs.shadowOffsetY=2,cvs.shadowColor=rndCol()):cvs.shadowBlur=0):l.onload=()=>{a&&(cvs.translate(e.left,e.top),cvs.rotate(a),cvs.translate(-e.left,-e.top)),cvs.drawImage(l,0,0,e.width,e.height,e.left,e.top,e.width2||e.width,e.height2||e.height),cvs.translate(e.left,e.top),cvs.rotate(-a),cvs.translate(-e.left,-e.top),e.luminous?(console.log("发光"),cvs.shadowBlur=80,cvs.shadowOffsetX=2,cvs.shadowOffsetY=2,cvs.shadowColor=rndCol()):cvs.shadowBlur=0}}else{const l=new Image;l.src=e.url,l.complete?(a&&(cvs.translate(e.left,e.top),cvs.rotate(a),cvs.translate(-e.left,-e.top)),cvs.drawImage(l,0,0,e.width,e.height,e.left,e.top,e.width2||e.width,e.height2||e.height),cvs.translate(e.left,e.top),cvs.rotate(-a),cvs.translate(-e.left,-e.top)):(a&&(cvs.translate(e.left,e.top),cvs.rotate(a),cvs.translate(-e.left,-e.top)),l.onload=()=>{cvs.drawImage(l,0,0,e.width,e.height,e.left,e.top,e.width2||e.width,e.height2||e.height),cvs.translate(e.left,e.top),cvs.rotate(-a),cvs.translate(-e.left,-e.top)})}}}function upTheImg(){null!=globalChooseImgMark&&(globalCanvasAllImgMsg.forEach(((l,a)=>{if(l.mark==globalChooseImgMark)return globalCanvasAllImgMsg.push(l),void globalCanvasAllImgMsg.splice(a,1)})),redraw(globalCanvasAllImgMsg))}function luminousTheImg(){null!=globalChooseImgMark&&(globalCanvasAllImgMsg.forEach(((l,a)=>{l.mark!=globalChooseImgMark||(l.luminous=!0)})),redraw(globalCanvasAllImgMsg))}function delTheImg(){null!=globalChooseImgMark&&(globalCanvasAllImgMsg.forEach(((l,a)=>{l.mark!=globalChooseImgMark||globalCanvasAllImgMsg.splice(a,1)})),redraw(globalCanvasAllImgMsg),globalChooseImgMark=null)}function moveTheImg(){null!=globalChooseImgMark&&canvasdom.addEventListener("mousemove",moveImg)}document.addEventListener("paste",getTheImage),document.onkeydown=l=>{switch(l.code){case"KeyX":delTheImg();break;case"KeyG":moveTheImg();break;case"KeyS":zoomTheImg();break;case"KeyU":upTheImg();break;case"KeyR":rotateTheImg();break;case"KeyF":luminousTheImg()}},canvasdom.onclick=l=>{canvasdom.removeEventListener("mousemove",moveImg),canvasdom.removeEventListener("mousemove",zoomImg),flag=!0;let{offsetX:a,offsetY:t}=l,e=globalCanvasAllImgMsg.filter((l=>l.left<a*resolution&&l.top<t*resolution&&l.left+l.width2>a*resolution&&l.top+l.height2>t*resolution));globalChooseImgMark=e.length>0?e[e.length-1].mark:null};let cleart=null;function moveImg(l){cleart||(cleart=setTimeout((()=>{let{offsetX:a,offsetY:t}=l;if(flag)return globalCanvasAllImgMsg.forEach(((l,e)=>{if(l.mark==globalChooseImgMark)return moveStartPosition.x=globalCanvasAllImgMsg[e].left-a*resolution,void(moveStartPosition.y=globalCanvasAllImgMsg[e].top-t*resolution)})),flag=!1,clearTimeout(cleart),void(cleart=null);globalCanvasAllImgMsg.forEach(((l,e)=>{if(l.mark==globalChooseImgMark)return globalCanvasAllImgMsg[e].left=moveStartPosition.x+a*resolution,void(globalCanvasAllImgMsg[e].top=moveStartPosition.y+t*resolution)})),redraw(globalCanvasAllImgMsg),clearTimeout(cleart),cleart=null}),33))}let cleart2=null;function zoomTheImg(){null!=globalChooseImgMark&&globalCanvasAllImgMsg.forEach(((l,a)=>{l.mark==globalChooseImgMark&&canvasdom.addEventListener("mousemove",zoomImg)}))}function zoomImg(l){cleart2=setTimeout((()=>{let{offsetX:a}=l;if(flag)return globalCanvasAllImgMsg.forEach(((l,a)=>{l.mark==globalChooseImgMark&&(clickOriginalSize.width=globalCanvasAllImgMsg[a].width2,clickOriginalSize.height=globalCanvasAllImgMsg[a].height2)})),clickStartLocationX=a,flag=!1,clearTimeout(cleart2),void(cleart2=null);globalCanvasAllImgMsg.forEach(((l,t)=>{l.mark==globalChooseImgMark&&(globalCanvasAllImgMsg[t].width2=a/clickStartLocationX*clickOriginalSize.width,globalCanvasAllImgMsg[t].height2=a/clickStartLocationX*clickOriginalSize.height)})),redraw(globalCanvasAllImgMsg),clearTimeout(cleart2),cleart2=null}),33)}
//# sourceMappingURL=index.d9c8994f.js.map
